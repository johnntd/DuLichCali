<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duy Hoa Travel Services</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
            background-size: cover;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
        }
        h1, h2 {
            text-align: center;
            color: #007BFF;
        }
        .contact-info {
            text-align: center;
            margin-bottom: 20px;
        }
        .lang-toggle {
            text-align: right;
            margin-bottom: 20px;
        }
        .lang-toggle button {
            padding: 10px 20px;
            background: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .service-toggle {
            margin-bottom: 20px;
        }
        select, input, button {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            background: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #218838;
        }
        .cost-estimate {
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .paypal-button {
            text-align: center;
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            select, input, button {
                font-size: 14px;
            }
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAoCDsW6-3UzZI11TMH62uLTE1uP1yX2Ts&libraries=places"></script>
</head>
<body>
    <div class="container">
        <div class="lang-toggle">
            <button onclick="toggleLanguage()">English</button>
        </div>
        <h1>Dịch Vụ Du Lịch</h1>
        <div class="contact-info">
            <p>Duy Hoa, Phone: <a href="tel:7142276007">714-227-6007</a>, Email: <a href="mailto:dulichcali21@gmail.com">dulichcali21@gmail.com</a></p>
        </div>
        <div class="service-toggle">
            <label for="service-type">Chọn Dịch Vụ:</label>
            <select id="service-type" onchange="toggleService()">
                <option value="travel">Gói Du Lịch</option>
                <option value="airport">Dịch Vụ Sân Bay</option>
            </select>
        </div>

        <!-- Travel Package Form -->
        <form id="travel-form" action="https://formspree.io/f/xeokgbpo" method="POST" onsubmit="return handleTravelSubmit(event)">
            <h2>Gói Du Lịch</h2>
            <label for="package">Gói:</label>
            <select id="package" onchange="updateDestinations()">
                <option value="custom">Đích Đến Tùy Chọn</option>
                <option value="disneyland">Disneyland Adventure</option>
                <option value="sandiego">San Diego Family Fun</option>
                <option value="universal">Universal Hollywood</option>
                <option value="nationalparks">National Parks Explorer</option>
                <option value="citygetaway">City Getaway</option>
            </select>
            <label for="destinations">Đích Đến:</label>
            <select id="destinations" multiple onchange="updateCost()"></select>
            <label for="extra-destinations">Đích Đến Thêm:</label>
            <select id="extra-destinations" multiple onchange="updateCost()"></select>
            <label for="travel-date">Ngày Đi:</label>
            <input type="date" id="travel-date" required onchange="checkAvailability()">
            <label for="days">Số Ngày:</label>
            <input type="number" id="days" min="1" value="1" required onchange="updateCost()">
            <label for="adults">Người Lớn (Disneyland/Universal):</label>
            <input type="number" id="adults" min="0" value="0" onchange="updateTravelerCount()">
            <label for="kids">Trẻ Em (Disneyland/Universal):</label>
            <input type="number" id="kids" min="0" value="0" onchange="updateTravelerCount()">
            <label for="travelers">Tổng Số Người (Đích đến khác):</label>
            <input type="number" id="travelers" min="1" max="12" required onchange="updateCost()">
            <label for="ticket-type">Loại Vé (Disneyland/Universal):</label>
            <select id="ticket-type" onchange="updateCost()">
                <option value="regular">Thường</option>
                <option value="vip">VIP</option>
                <option value="express">Express</option>
            </select>
            <label for="lodging">Chỗ Ở:</label>
            <select id="lodging" onchange="toggleLodgingFields()">
                <option value="none">Không Có</option>
                <option value="airbnb">Airbnb</option>
                <option value="hotel">Khách Sạn</option>
            </select>
            <div id="no-lodging-fields" class="hidden">
                <label for="dropoff-address">Địa Chỉ Đưa Đón:</label>
                <input type="text" id="dropoff-address" placeholder="Nhập địa chỉ">
            </div>
            <label for="meals">Bữa Ăn (Chỉ Khu Vực Vịnh):</label>
            <input type="checkbox" id="meals" onchange="updateCost()" disabled>
            <label for="airport-pickup">Đón Sân Bay:</label>
            <input type="checkbox" id="airport-pickup" onchange="toggleAirportFields()">
            <div id="airport-fields" class="hidden">
                <label for="airport">Sân Bay:</label>
                <select id="airport" onchange="updateCost()">
                    <option value="SNA">SNA</option>
                    <option value="LAX">LAX</option>
                    <option value="LGB">LGB</option>
                </select>
                <label for="pickup-address">Địa Chỉ Đón:</label>
                <input type="text" id="pickup-address" placeholder="Nhập địa chỉ">
            </div>
            <label for="name">Họ Tên:</label>
            <input type="text" id="name" name="name" required>
            <label for="phone">Số Điện Thoại:</label>
            <input type="tel" id="phone" name="phone" required>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
            <div class="cost-estimate" id="travel-cost"></div>
            <div class="paypal-button">
                <p>Thanh toán phí chỗ ở và vé qua PayPal:</p>
                <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                    <input type="hidden" name="cmd" value="_xclick">
                    <input type="hidden" name="business" value="Johnntd21@icloud.com">
                    <input type="hidden" name="item_name" value="Lodging and Admission Fees">
                    <input type="hidden" name="amount" id="paypal-amount" value="0">
                    <input type="hidden" name="currency_code" value="USD">
                    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_buynowCC_LG.gif" name="submit" alt="PayPal">
                </form>
            </div>
            <button type="submit">Gửi Yêu Cầu</button>
        </form>

        <!-- Airport Service Form -->
        <form id="airport-form" action="https://formspree.io/f/xeokgbpo" method="POST" class="hidden" onsubmit="return handleAirportSubmit(event)">
            <h2>Dịch Vụ Sân Bay</h2>
            <label for="service">Loại Dịch Vụ:</label>
            <select id="service" onchange="toggleAirportServiceFields()">
                <option value="pickup">Đón</option>
                <option value="dropoff">Đưa</option>
            </select>
            <label for="airport-service">Sân Bay:</label>
            <select id="airport-service" onchange="updateAirportCost()">
                <option value="SNA">SNA</option>
                <option value="LAX">LAX</option>
                <option value="LGB">LGB</option>
            </select>
            <label for="address">Địa Chỉ:</label>
            <input type="text" id="address" required placeholder="Nhập địa chỉ">
            <label for="people">Số Người:</label>
            <input type="number" id="people" min="1" max="12" required onchange="updateAirportCost()">
            <label for="date">Ngày:</label>
            <input type="date" id="date" required onchange="checkAvailability()">
            <label for="time">Giờ:</label>
            <input type="time" id="time" required>
            <label for="customer-name">Họ Tên:</label>
            <input type="text" id="customer-name" name="name" required>
            <label for="customer-phone">Số Điện Thoại:</label>
            <input type="tel" id="customer-phone" name="phone" required>
            <div class="cost-estimate" id="airport-cost"></div>
            <button type="submit">Gửi Yêu Cầu</button>
            <div class="paypal-button">
                <p>Thanh toán sau:</p>
                <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                    <input type="hidden" name="cmd" value="_xclick">
                    <input type="hidden" name="business" value="Johnntd21@icloud.com">
                    <input type="hidden" name="item_name" value="Airport Service">
                    <input type="hidden" name="amount" id="paypal-airport-amount" value="0">
                    <input type="hidden" name="currency_code" value="USD">
                    <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_buynowCC_LG.gif" name="submit" alt="PayPal">
                </form>
            </div>
        </form>
    </div>

    <script>
        // Language Toggle
        const translations = {
            vi: {
                title: "Dịch Vụ Du Lịch",
                serviceLabel: "Chọn Dịch Vụ:",
                travel: "Gói Du Lịch",
                airport: "Dịch Vụ Sân Bay",
                travelTitle: "Gói Du Lịch",
                package: "Gói:",
                destinations: "Đích Đến:",
                extraDestinations: "Đích Đến Thêm:",
                travelDate: "Ngày Đi:",
                days: "Số Ngày:",
                adults: "Người Lớn (Disneyland/Universal):",
                kids: "Trẻ Em (Disneyland/Universal):",
                travelers: "Tổng Số Người (Đích đến khác):",
                ticketType: "Loại Vé (Disneyland/Universal):",
                lodging: "Chỗ Ở:",
                dropoffAddress: "Địa Chỉ Đưa Đón:",
                meals: "Bữa Ăn (Chỉ Khu Vực Vịnh):",
                airportPickup: "Đón Sân Bay:",
                airport: "Sân Bay:",
                pickupAddress: "Địa Chỉ Đón:",
                name: "Họ Tên:",
                phone: "Số Điện Thoại:",
                email: "Email:",
                submit: "Gửi Yêu Cầu",
                airportTitle: "Dịch Vụ Sân Bay",
                service: "Loại Dịch Vụ:",
                address: "Địa Chỉ:",
                people: "Số Người:",
                date: "Ngày:",
                time: "Giờ:",
                customerName: "Họ Tên:",
                customerPhone: "Số Điện Thoại:",
                packages: {
                    custom: "Đích Đến Tùy Chọn",
                    disneyland: "Disneyland Adventure",
                    sandiego: "San Diego Family Fun",
                    universal: "Universal Hollywood",
                    nationalparks: "National Parks Explorer",
                    citygetaway: "City Getaway"
                },
                ticketTypes: {
                    regular: "Thường",
                    vip: "VIP",
                    express: "Express"
                },
                lodgingOptions: {
                    none: "Không Có",
                    airbnb: "Airbnb",
                    hotel: "Khách Sạn"
                }
            },
            en: {
                title: "Travel Services",
                serviceLabel: "Select Service:",
                travel: "Travel Package",
                airport: "Airport Service",
                travelTitle: "Travel Package",
                package: "Package:",
                destinations: "Destinations:",
                extraDestinations: "Extra Destinations:",
                travelDate: "Travel Date:",
                days: "Number of Days:",
                adults: "Adults (Disneyland/Universal):",
                kids: "Kids (Disneyland/Universal):",
                travelers: "Total Travelers (Other destinations):",
                ticketType: "Ticket Type (Disneyland/Universal):",
                lodging: "Lodging:",
                dropoffAddress: "Drop-off Address:",
                meals: "Meals (Bay Area Only):",
                airportPickup: "Airport Pickup:",
                airport: "Airport:",
                pickupAddress: "Pickup Address:",
                name: "Full Name:",
                phone: "Phone Number:",
                email: "Email:",
                submit: "Submit Request",
                airportTitle: "Airport Service",
                service: "Service Type:",
                address: "Address:",
                people: "Number of People:",
                date: "Date:",
                time: "Time:",
                customerName: "Full Name:",
                customerPhone: "Phone Number:",
                packages: {
                    custom: "Custom Destinations",
                    disneyland: "Disneyland Adventure",
                    sandiego: "San Diego Family Fun",
                    universal: "Universal Hollywood",
                    nationalparks: "National Parks Explorer",
                    citygetaway: "City Getaway"
                },
                ticketTypes: {
                    regular: "Regular",
                    vip: "VIP",
                    express: "Express"
                },
                lodgingOptions: {
                    none: "No Lodging",
                    airbnb: "Airbnb",
                    hotel: "Hotel"
                }
            }
        };
        let currentLang = 'vi';

        function toggleLanguage() {
            currentLang = currentLang === 'vi' ? 'en' : 'vi';
            document.querySelector('.lang-toggle button').textContent = currentLang === 'vi' ? 'English' : 'Tiếng Việt';
            document.querySelector('h1').textContent = translations[currentLang].title;
            document.querySelector('#service-type option[value="travel"]').textContent = translations[currentLang].travel;
            document.querySelector('#service-type option[value="airport"]').textContent = translations[currentLang].airport;
            document.querySelector('#travel-form h2').textContent = translations[currentLang].travelTitle;
            document.querySelector('#airport-form h2').textContent = translations[currentLang].airportTitle;
            updateFormLabels();
        }

        function updateFormLabels() {
            const labels = translations[currentLang];
            document.querySelector('label[for="service-type"]').textContent = labels.serviceLabel;
            document.querySelector('label[for="package"]').textContent = labels.package;
            document.querySelector('label[for="destinations"]').textContent = labels.destinations;
            document.querySelector('label[for="extra-destinations"]').textContent = labels.extraDestinations;
            document.querySelector('label[for="travel-date"]').textContent = labels.travelDate;
            document.querySelector('label[for="days"]').textContent = labels.days;
            document.querySelector('label[for="adults"]').textContent = labels.adults;
            document.querySelector('label[for="kids"]').textContent = labels.kids;
            document.querySelector('label[for="travelers"]').textContent = labels.travelers;
            document.querySelector('label[for="ticket-type"]').textContent = labels.ticketType;
            document.querySelector('label[for="lodging"]').textContent = labels.lodging;
            document.querySelector('label[for="dropoff-address"]').textContent = labels.dropoffAddress;
            document.querySelector('label[for="meals"]').textContent = labels.meals;
            document.querySelector('label[for="airport-pickup"]').textContent = labels.airportPickup;
            document.querySelector('label[for="airport"]').textContent = labels.airport;
            document.querySelector('label[for="pickup-address"]').textContent = labels.pickupAddress;
            document.querySelector('label[for="name"]').textContent = labels.name;
            document.querySelector('label[for="phone"]').textContent = labels.phone;
            document.querySelector('label[for="email"]').textContent = labels.email;
            document.querySelector('#travel-form button').textContent = labels.submit;
            document.querySelector('label[for="service"]').textContent = labels.service;
            document.querySelector('label[for="airport-service"]').textContent = labels.airport;
            document.querySelector('label[for="address"]').textContent = labels.address;
            document.querySelector('label[for="people"]').textContent = labels.people;
            document.querySelector('label[for="date"]').textContent = labels.date;
            document.querySelector('label[for="time"]').textContent = labels.time;
            document.querySelector('label[for="customer-name"]').textContent = labels.customerName;
            document.querySelector('label[for="customer-phone"]').textContent = labels.customerPhone;
            document.querySelector('#airport-form button').textContent = labels.submit;

            // Update package options
            const packageSelect = document.querySelector('#package');
            packageSelect.innerHTML = '';
            for (const [key, value] of Object.entries(labels.packages)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value;
                packageSelect.appendChild(option);
            }

            // Update ticket type options
            const ticketSelect = document.querySelector('#ticket-type');
            ticketSelect.innerHTML = '';
            for (const [key, value] of Object.entries(labels.ticketTypes)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value;
                ticketSelect.appendChild(option);
            }

            // Update lodging options
            const lodgingSelect = document.querySelector('#lodging');
            lodgingSelect.innerHTML = '';
            for (const [key, value] of Object.entries(labels.lodgingOptions)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value;
                lodgingSelect.appendChild(option);
            }
        }

        // Service Toggle
        function toggleService() {
            const service = document.querySelector('#service-type').value;
            document.querySelector('#travel-form').classList.toggle('hidden', service !== 'travel');
            document.querySelector('#airport-form').classList.toggle('hidden', service !== 'airport');
        }

        // Data
        const destinations = [
            { name: 'Disneyland', distance: 60, admission: { regular: { adult: 150, kid: 100 }, vip: { adult: 300, kid: 200 }, express: { adult: 200, kid: 150 } } },
            { name: 'California Adventure', distance: 60, admission: { regular: { adult: 150, kid: 100 }, vip: { adult: 300, kid: 200 }, express: { adult: 200, kid: 150 } } },
            { name: 'Universal Studios', distance: 100, admission: { regular: { adult: 120, kid: 80 }, vip: { adult: 250, kid: 180 }, express: { adult: 180, kid: 130 } } },
            { name: 'San Diego Zoo', distance: 190, admission: { regular: { adult: 70, kid: 70 } } },
            { name: 'SeaWorld', distance: 190, admission: { regular: { adult: 90, kid: 90 } } },
            { name: 'LegoLand', distance: 140, admission: { regular: { adult: 100, kid: 100 } } },
            { name: 'Las Vegas', distance: 540, admission: { regular: { adult: 0, kid: 0 } } },
            { name: 'Grand Canyon', distance: 960, admission: { regular: { adult: 25, kid: 25 } } },
            { name: 'San Francisco', distance: 860, admission: { regular: { adult: 0, kid: 0 } } },
            { name: 'Yosemite', distance: 700, admission: { regular: { adult: 20, kid: 20 } } },
            { name: 'Lake Tahoe', distance: 960, admission: { regular: { adult: 0, kid: 0 } } },
            { name: 'Reno', distance: 1000, admission: { regular: { adult: 0, kid: 0 } } },
            { name: 'Silicon Valley', distance: 760, admission: { regular: { adult: 20, kid: 20 } } }
        ];

        const packages = {
            custom: [],
            disneyland: ['Disneyland', 'California Adventure'],
            sandiego: ['San Diego Zoo', 'SeaWorld', 'LegoLand'],
            universal: ['Universal Studios'],
            nationalparks: ['Grand Canyon', 'Yosemite'],
            citygetaway: ['Las Vegas', 'San Francisco', 'Reno']
        };

        const lodgingCosts = {
            'Disneyland': { hotel: 200, airbnb: 150 },
            'California Adventure': { hotel: 200, airbnb: 150 },
            'Universal Studios': { hotel: 180, airbnb: 130 },
            'San Diego Zoo': { hotel: 160, airbnb: 120 },
            'SeaWorld': { hotel: 160, airbnb: 120 },
            'LegoLand': { hotel: 160, airbnb: 120 },
            'Las Vegas': { hotel: 100, airbnb: 80 },
            'Grand Canyon': { hotel: 120, airbnb: 90 },
            'San Francisco': { hotel: 250, airbnb: 200 },
            'Yosemite': { hotel: 180, airbnb: 140 },
            'Lake Tahoe': { hotel: 200, airbnb: 160 },
            'Reno': { hotel: 100, airbnb: 80 },
            'Silicon Valley': { hotel: 250, airbnb: 200 }
        };

        // Simulated booked dates (replace with real backend)
        const bookedDates = ['2025-06-15', '2025-06-20'];

        function checkAvailability() {
            const travelDate = document.querySelector('#travel-date').value;
            const airportDate = document.querySelector('#date').value;
            const dateInput = travelDate || airportDate;
            if (bookedDates.includes(dateInput)) {
                alert(currentLang === 'vi' ? 'Ngày này đã được đặt. Vui lòng chọn ngày khác.' : 'This date is booked. Please select another date.');
                document.querySelector('#travel-date').value = '';
                document.querySelector('#date').value = '';
            }
        }

        // Google Maps Distance Calculation
        const distanceService = new google.maps.DistanceMatrixService();
        async function calculateDistance(origin, destination) {
            return new Promise((resolve) => {
                distanceService.getDistanceMatrix({
                    origins: [origin],
                    destinations: [destination],
                    travelMode: 'DRIVING',
                    unitSystem: google.maps.UnitSystem.IMPERIAL
                }, (response, status) => {
                    if (status === 'OK' && response.rows[0].elements[0].status === 'OK') {
                        const distance = response.rows[0].elements[0].distance.value / 1609.34; // Convert meters to miles
                        resolve(distance);
                    } else {
                        resolve(null);
                    }
                });
            });
        }

        // Travel Package Logic
        function updateDestinations() {
            const package = document.querySelector('#package').value;
            const destinationsSelect = document.querySelector('#destinations');
            const extraDestinationsSelect = document.querySelector('#extra-destinations');
            destinationsSelect.innerHTML = '';
            extraDestinationsSelect.innerHTML = '';

            const selectedDestinations = packages[package];
            selectedDestinations.forEach(dest => {
                const option = document.createElement('option');
                option.value = dest;
                option.textContent = dest;
                option.selected = true;
                destinationsSelect.appendChild(option);
            });

            destinations.filter(d => !selectedDestinations.includes(d.name)).forEach(dest => {
                const option = document.createElement('option');
                option.value = dest.name;
                option.textContent = dest.name;
                extraDestinationsSelect.appendChild(option);
            });

            updateMealsOption();
            updateCost();
        }

        function updateTravelerCount() {
            const adults = parseInt(document.querySelector('#adults').value) || 0;
            const kids = parseInt(document.querySelector('#kids').value) || 0;
            const package = document.querySelector('#package').value;
            if (['disneyland', 'universal'].includes(package)) {
                document.querySelector('#travelers').value = adults + kids;
            }
            updateCost();
        }

        function toggleLodgingFields() {
            const lodging = document.querySelector('#lodging').value;
            document.querySelector('#no-lodging-fields').classList.toggle('hidden', lodging !== 'none');
            updateCost();
        }

        function toggleAirportFields() {
            const pickup = document.querySelector('#airport-pickup').checked;
            document.querySelector('#airport-fields').classList.toggle('hidden', !pickup);
            updateCost();
        }

        function updateMealsOption() {
            const selectedDestinations = Array.from(document.querySelector('#destinations').selectedOptions).map(opt => opt.value);
            const extraDestinations = Array.from(document.querySelector('#extra-destinations').selectedOptions).map(opt => opt.value);
            const allDestinations = [...selectedDestinations, ...extraDestinations];
            const bayArea = ['San Francisco', 'Silicon Valley'];
            const mealsCheckbox = document.querySelector('#meals');
            mealsCheckbox.disabled = !allDestinations.some(dest => bayArea.includes(dest));
            if (mealsCheckbox.disabled) mealsCheckbox.checked = false;
            updateCost();
        }

        async function updateCost() {
            const package = document.querySelector('#package').value;
            const selectedDestinations = Array.from(document.querySelector('#destinations').selectedOptions).map(opt => opt.value);
            const extraDestinations = Array.from(document.querySelector('#extra-destinations').selectedOptions).map(opt => opt.value);
            const allDestinations = [...selectedDestinations, ...extraDestinations];
            const days = parseInt(document.querySelector('#days').value) || 1;
            const adults = parseInt(document.querySelector('#adults').value) || 0;
            const kids = parseInt(document.querySelector('#kids').value) || 0;
            const travelers = parseInt(document.querySelector('#travelers').value) || 1;
            const ticketType = document.querySelector('#ticket-type').value;
            const lodging = document.querySelector('#lodging').value;
            const airportPickup = document.querySelector('#airport-pickup').checked;
            const airport = document.querySelector('#airport').value;
            const pickupAddress = document.querySelector('#pickup-address').value;
            const dropoffAddress = document.querySelector('#dropoff-address').value;
            const meals = document.querySelector('#meals').checked;

            let transportCost = 0;
            let admissionCost = 0;
            let lodgingCost = 0;
            let mealsCost = 0;
            let airportCost = 0;

            // Transportation Cost
            const furthestDestination = allDestinations.reduce((max, dest) => {
                const destination = destinations.find(d => d.name === dest);
                return destination.distance > (max.distance || 0) ? destination : max;
            }, {});
            transportCost = furthestDestination.distance * 2 * 2.50 * days;
            if (travelers > 3) {
                transportCost += 30 * days;
                transportCost *= 1.2;
            }

            // Admission Cost
            allDestinations.forEach(dest => {
                const destination = destinations.find(d => d.name === dest);
                if (['Disneyland', 'California Adventure', 'Universal Studios'].includes(dest)) {
                    admissionCost += adults * (destination.admission[ticketType]?.adult || 0);
                    admissionCost += kids * (destination.admission[ticketType]?.kid || 0);
                } else {
                    admissionCost += travelers * (destination.admission.regular.adult || 0);
                }
            });

            // Lodging Cost
            const primaryDestination = allDestinations[0] || 'Disneyland';
            if (lodging === 'hotel') {
                const baseCost = lodgingCosts[primaryDestination].hotel;
                lodgingCost = travelers > 5 ? baseCost * 2 * days : baseCost * days;
            } else if (lodging === 'airbnb') {
                const baseCost = lodgingCosts[primaryDestination].airbnb;
                lodgingCost = baseCost * (1 + (travelers - 1) * 0.1) * days;
            }

            // Meals Cost
            if (meals && allDestinations.some(dest => ['San Francisco', 'Silicon Valley'].includes(dest))) {
                mealsCost = 35 * travelers * days;
            }

            // Airport Pickup Cost
            if (airportPickup) {
                if (lodging !== 'none') {
                    airportCost = 50;
                } else if (pickupAddress) {
                    if (pickupAddress.match(/90[0-9]{3}/)) airportCost = 100;
                    else if (pickupAddress.match(/908[0-9]{2}/)) airportCost = 80;
                    else if (pickupAddress.match(/926[0-9]{2}|927[0-9]{2}|928[0-9]{2}/) || pickupAddress.includes('Anaheim') || pickupAddress.includes('Irvine') || pickupAddress.includes('Huntington Beach')) {
                        airportCost = 50;
                    } else {
                        const distance = await calculateDistance('Santa Ana, CA', pickupAddress);
                        airportCost = distance ? distance * 2 * 2.50 : 150;
                    }
                }
                if (travelers > 3) {
                    airportCost += 30;
                    airportCost *= 1.2;
                }
            }

            // Update Cost Estimate
            const total = transportCost + admissionCost + lodgingCost + mealsCost + airportCost;
            document.querySelector('#travel-cost').innerHTML = `
                <h3>${currentLang === 'vi' ? 'Ước Tính Chi Phí' : 'Cost Estimate'}</h3>
                <p>${currentLang === 'vi' ? 'Vận Chuyển' : 'Transportation'}: $${transportCost.toFixed(2)}</p>
                <p>${currentLang === 'vi' ? 'Vé Vào Cửa' : 'Admission Tickets'}: $${admissionCost.toFixed(2)}</p>
                <p>${currentLang === 'vi' ? 'Chỗ Ở' : 'Lodging'}: $${lodgingCost.toFixed(2)}</p>
                <p>${currentLang === 'vi' ? 'Bữa Ăn' : 'Meals'}: $${mealsCost.toFixed(2)}</p>
                <p>${currentLang === 'vi' ? 'Đón Sân Bay' : 'Airport Pickup'}: $${airportCost.toFixed(2)}</p>
                <p><strong>${currentLang === 'vi' ? 'Tổng Cộng' : 'Total'}: $${total.toFixed(2)}</strong></p>
            `;
            document.querySelector('#paypal-amount').value = (admissionCost + lodgingCost).toFixed(2);
        }

        function handleTravelSubmit(event) {
            event.preventDefault();
            const form = event.target;
            form.submit();
            window.location.href = 'thankyou.html';
        }

        // Airport Service Logic
        function toggleAirportServiceFields() {
            updateAirportCost();
        }

        async function updateAirportCost() {
            const service = document.querySelector('#service').value;
            const airport = document.querySelector('#airport-service').value;
            const address = document.querySelector('#address').value;
            const people = parseInt(document.querySelector('#people').value) || 1;

            let cost = 0;
            if (address.match(/90[0-9]{3}/)) cost = 100;
            else if (address.match(/908[0-9]{2}/)) cost = 80;
            else if (address.match(/926[0-9]{2}|927[0-9]{2}|928[0-9]{2}/) || address.includes('Anaheim') || address.includes('Irvine') || address.includes('Huntington Beach')) {
                cost = 50;
            } else {
                const distance = await calculateDistance('Santa Ana, CA', address);
                cost = distance ? distance * 2 * 2.50 : 150;
            }

            if (people > 3) {
                cost += 30;
                cost *= 1.2;
            }

            document.querySelector('#airport-cost').innerHTML = `
                <h3>${currentLang === 'vi' ? 'Ước Tính Chi Phí' : 'Cost Estimate'}</h3>
                <p>${currentLang === 'vi' ? 'Dịch Vụ Sân Bay' : 'Airport Service'}: $${cost.toFixed(2)}</p>
            `;
            document.querySelector('#paypal-airport-amount').value = cost.toFixed(2);
        }

        function handleAirportSubmit(event) {
            event.preventDefault();
            const form = event.target;
            form.submit();
            window.location.href = 'thankyou.html';
        }

        // Initialize
        updateDestinations();
        updateFormLabels();
        document.querySelector('#travel-date').min = new Date().toISOString().split('T')[0];
        document.querySelector('#date').min = new Date().toISOString().split('T')[0];

        // Autocomplete for addresses
        const pickupAddress = document.querySelector('#pickup-address');
        const dropoffAddress = document.querySelector('#dropoff-address');
        const address = document.querySelector('#address');
        if (pickupAddress) new google.maps.places.Autocomplete(pickupAddress);
        if (dropoffAddress) new google.maps.places.Autocomplete(dropoffAddress);
        if (address) new google.maps.places.Autocomplete(address);
    </script>
</body>
</html>
