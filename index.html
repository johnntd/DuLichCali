<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Du Lịch Cali - Đặt Dịch Vụ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=2073&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        h1, h2 {
            text-align: center;
            color: #ff6f00;
        }
        .language-toggle {
            text-align: right;
            margin-bottom: 20px;
        }
        .language-toggle button {
            padding: 10px 20px;
            background: #ff6f00;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .contact-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button[type="submit"], .paypal-button {
            width: 100%;
            padding: 15px;
            background: #ff6f00;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
        }
        .cost-estimate {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        .hidden {
            display: none;
        }
        @media (max-width: 600px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            h1 {
                font-size: 1.5em;
            }
            input, select, textarea, button {
                font-size: 0.9em;
            }
        }
    </style>
    <script src="https://www.paypal.com/sdk/js?client-id=AYbI3E3uW8Y0s8y8b8x8r8v8t8y8z8"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
</head>
<body>
    <div class="container">
        <div class="language-toggle">
            <button onclick="toggleLanguage()">English</button>
        </div>
        <h1>Du Lịch Cali</h1>
        <div class="contact-info">
            Duy Hoa, Phone: <a href="tel:714-227-6007">714-227-6007</a>, Email: <a href="mailto:dulichcali21@gmail.com">dulichcali21@gmail.com</a>
        </div>
        <div class="form-group">
            <label for="service-type">Dịch Vụ</label>
            <select id="service-type" onchange="toggleServiceForm()">
                <option value="airport">Dịch Vụ Sân Bay</option>
                <option value="travel">Gói Du Lịch</option>
            </select>
        </div>

        <!-- Airport Service Form -->
        <form id="airport-form" action="https://formspree.io/f/xeokgbpo" method="POST">
            <h2>Dịch Vụ Sân Bay</h2>
            <div class="form-group">
                <label for="airport-service-type">Loại Dịch Vụ</label>
                <select id="airport-service-type" name="airport-service-type" onchange="updateAirportForm()">
                    <option value="pickup">Đón Tại Sân Bay</option>
                    <option value="dropoff">Đưa Đến Sân Bay</option>
                </select>
            </div>
            <div class="form-group">
                <label for="airport">Sân Bay</label>
                <select id="airport" name="airport">
                    <option value="SNA">SNA - Santa Ana</option>
                    <option value="LAX">LAX - Los Angeles</option>
                    <option value="LGB">LGB - Long Beach</option>
                </select>
            </div>
            <div class="form-group" id="address-group">
                <label for="address">Địa Chỉ</label>
                <input type="text" id="address" name="address" required>
            </div>
            <div class="form-group">
                <label for="travelers">Số Hành Khách (1–12)</label>
                <input type="number" id="travelers" name="travelers" min="1" max="12" value="1" required onchange="updateCostEstimate()">
            </div>
            <div class="form-group">
                <label for="pickup-date">Ngày/Giờ</label>
                <input type="datetime-local" id="pickup-date" name="pickup-date" required onchange="checkAvailability()">
            </div>
            <div class="form-group">
                <label for="customer-name">Họ Tên</label>
                <input type="text" id="customer-name" name="customer-name" required>
            </div>
            <div class="form-group">
                <label for="phone">Số Điện Thoại</label>
                <input type="tel" id="phone" name="phone" required>
            </div>
            <div class="cost-estimate" id="airport-cost-estimate"></div>
            <button type="submit">Đặt Dịch Vụ (Thanh Toán Sau)</button>
        </form>

        <!-- Travel Package Form -->
        <form id="travel-form" action="https://formspree.io/f/xeokgbpo" method="POST" class="hidden">
            <h2>Gói Du Lịch</h2>
            <div class="form-group">
                <label for="package">Gói Du Lịch</label>
                <select id="package" name="package" onchange="updateTravelForm()">
                    <option value="custom">Tùy Chỉnh Điểm Đến</option>
                    <option value="disneyland">Disneyland Adventure</option>
                    <option value="sandiego">San Diego Family Fun</option>
                    <option value="universal">Universal Hollywood</option>
                    <option value="nationalparks">National Parks Explorer</option>
                    <option value="citygetaway">City Getaway</option>
                </select>
            </div>
            <div class="form-group" id="destinations-group">
                <label for="destinations">Điểm Đến</label>
                <select id="destinations" name="destinations" multiple onchange="updateCostEstimate()">
                    <option value="Disneyland">Disneyland</option>
                    <option value="California Adventure">California Adventure</option>
                    <option value="Universal Studios">Universal Studios</option>
                    <option value="San Diego Zoo">San Diego Zoo</option>
                    <option value="SeaWorld">SeaWorld</option>
                    <option value="LegoLand">LegoLand</option>
                    <option value="Las Vegas">Las Vegas</option>
                    <option value="Grand Canyon">Grand Canyon</option>
                    <option value="San Francisco">San Francisco</option>
                    <option value="Yosemite">Yosemite</option>
                    <option value="Lake Tahoe">Lake Tahoe</option>
                    <option value="Reno">Reno</option>
                    <option value="Silicon Valley">Silicon Valley</option>
                </select>
            </div>
            <div class="form-group" id="adults-group">
                <label for="adults">Số Người Lớn</label>
                <input type="number" id="adults" name="adults" min="0" value="0" onchange="updateTravelers()">
            </div>
            <div class="form-group" id="kids-group">
                <label for="kids">Số Trẻ Em</label>
                <input type="number" id="kids" name="kids" min="0" value="0" onchange="updateTravelers()">
            </div>
            <div class="form-group" id="travelers-group" class="hidden">
                <label for="travelers-travel">Số Hành Khách (1–12)</label>
                <input type="number" id="travelers-travel" name="travelers-travel" min="1" max="12" value="1" onchange="updateCostEstimate()">
            </div>
            <div class="form-group">
                <label for="days">Số Ngày</label>
                <input type="number" id="days" name="days" min="1" value="1" onchange="updateCostEstimate()">
            </div>
            <div class="form-group">
                <label for="lodging">Chỗ Ở</label>
                <select id="lodging" name="lodging" onchange="updateLodging()">
                    <option value="none">Không Có</option>
                    <option value="airbnb">Airbnb</option>
                    <option value="hotel">Khách Sạn</option>
                </select>
            </div>
            <div class="form-group" id="dropoff-address-group" class="hidden">
                <label for="dropoff-address">Địa Chỉ Đưa Đến</label>
                <input type="text" id="dropoff-address" name="dropoff-address">
            </div>
            <div class="form-group" id="meals-group" class="hidden">
                <label for="meals">Bữa Ăn Nhà Nấu ($35/ngày/người)</label>
                <input type="checkbox" id="meals" name="meals" onchange="updateCostEstimate()">
            </div>
            <div class="form-group">
                <label for="airport-pickup">Đón Sân Bay</label>
                <input type="checkbox" id="airport-pickup" name="airport-pickup" onchange="toggleAirportPickup()">
            </div>
            <div id="airport-pickup-group" class="hidden">
                <div class="form-group">
                    <label for="pickup-airport">Sân Bay</label>
                    <select id="pickup-airport" name="pickup-airport">
                        <option value="SNA">SNA - Santa Ana</option>
                        <option value="LAX">LAX - Los Angeles</option>
                        <option value="LGB">LGB - Long Beach</option>
                    </select>
                </div>
                <div class="form-group" id="pickup-address-group" class="hidden">
                    <label for="pickup-address">Địa Chỉ Đón</label>
                    <input type="text" id="pickup-address" name="pickup-address">
                </div>
            </div>
            <div class="form-group">
                <label for="pickup-date-travel">Ngày/Giờ Đón</label>
                <input type="datetime-local" id="pickup-date-travel" name="pickup-date-travel" required onchange="checkAvailability()">
            </div>
            <div class="form-group">
                <label for="customer-name-travel">Họ Tên</label>
                <input type="text" id="customer-name-travel" name="customer-name-travel" required>
            </div>
            <div class="form-group">
                <label for="phone-travel">Số Điện Thoại</label>
                <input type="tel" id="phone-travel" name="phone-travel" required>
            </div>
            <div class="form-group">
                <label for="email-travel">Email</label>
                <input type="email" id="email-travel" name="email-travel" required>
            </div>
            <div class="cost-estimate" id="travel-cost-estimate"></div>
            <button type="submit">Đặt Dịch Vụ</button>
            <div id="paypal-button-container" class="paypal-button"></div>
        </form>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBw8WZLeSD_JrzJhChKaedZyP8XFdtStgY",
            authDomain: "dulichcali.firebaseapp.com",
            projectId: "dulichcali",
            storageBucket: "dulichcali.firebasestorage.app",
            messagingSenderId: "178151315890",
            appId: "1:178151315890:web:32179635828a6e150eecab",
            measurementId: "G-MM9TZVMTVL"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Google Maps API
        const googleMapsApiKey = "AIzaSyAoCDsW6-3UzZI11TMH62uLTE1uP1yX2Ts";

        // Language Toggle
        let currentLang = "vi";
        const translations = {
            vi: {
                title: "Du Lịch Cali",
                service: "Dịch Vụ",
                airport_service: "Dịch Vụ Sân Bay",
                travel_package: "Gói Du Lịch",
                service_type: "Loại Dịch Vụ",
                pickup: "Đón Tại Sân Bay",
                dropoff: "Đưa Đến Sân Bay",
                airport: "Sân Bay",
                address: "Địa Chỉ",
                travelers: "Số Hành Khách (1–12)",
                date_time: "Ngày/Giờ",
                name: "Họ Tên",
                phone: "Số Điện Thoại",
                package: "Gói Du Lịch",
                destinations: "Điểm Đến",
                adults: "Số Người Lớn",
                kids: "Số Trẻ Em",
                days: "Số Ngày",
                lodging: "Chỗ Ở",
                no_lodging: "Không Có",
                airbnb: "Airbnb",
                hotel: "Khách Sạn",
                dropoff_address: "Địa Chỉ Đưa Đến",
                meals: "Bữa Ăn Nhà Nấu ($35/ngày/người)",
                airport_pickup: "Đón Sân Bay",
                pickup_airport: "Sân Bay",
                pickup_address: "Địa Chỉ Đón",
                email: "Email",
                submit_airport: "Đặt Dịch Vụ (Thanh Toán Sau)",
                submit_travel: "Đặt Dịch Vụ"
            },
            en: {
                title: "Cali Travel",
                service: "Service",
                airport_service: "Airport Service",
                travel_package: "Travel Package",
                service_type: "Service Type",
                pickup: "Pickup at Airport",
                dropoff: "Drop-off at Airport",
                airport: "Airport",
                address: "Address",
                travelers: "Number of Travelers (1–12)",
                date_time: "Date/Time",
                name: "Full Name",
                phone: "Phone Number",
                package: "Travel Package",
                destinations: "Destinations",
                adults: "Number of Adults",
                kids: "Number of Kids",
                days: "Number of Days",
                lodging: "Lodging",
                no_lodging: "No Lodging",
                airbnb: "Airbnb",
                hotel: "Hotel",
                dropoff_address: "Drop-off Address",
                meals: "Home-Cooked Meals ($35/day/person)",
                airport_pickup: "Airport Pickup",
                pickup_airport: "Airport",
                pickup_address: "Pickup Address",
                email: "Email",
                submit_airport: "Book Service (Pay Later)",
                submit_travel: "Book Service"
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === "vi" ? "en" : "vi";
            document.querySelector(".language-toggle button").textContent = currentLang === "vi" ? "English" : "Tiếng Việt";
            document.querySelector("h1").textContent = translations[currentLang].title;
            document.querySelector("#service-type").options[0].text = translations[currentLang].airport_service;
            document.querySelector("#service-type").options[1].text = translations[currentLang].travel_package;
            document.querySelector("#airport-form h2").textContent = translations[currentLang].airport_service;
            document.querySelector("#travel-form h2").textContent = translations[currentLang].travel_package;
            updateFormLabels();
        }

        function updateFormLabels() {
            const labels = document.querySelectorAll("label");
            const inputs = document.querySelectorAll("input, select, button");
            labels.forEach(label => {
                const forAttr = label.getAttribute("for");
                if (translations[currentLang][forAttr]) {
                    label.textContent = translations[currentLang][forAttr];
                }
            });
            inputs.forEach(input => {
                if (input.type === "submit") {
                    input.textContent = input.form.id === "airport-form" ? translations[currentLang].submit_airport : translations[currentLang].submit_travel;
                }
            });
        }

        // Form Toggle
        function toggleServiceForm() {
            const serviceType = document.getElementById("service-type").value;
            document.getElementById("airport-form").classList.toggle("hidden", serviceType !== "airport");
            document.getElementById("travel-form").classList.toggle("hidden", serviceType !== "travel");
            updateCostEstimate();
        }

        // Airport Form Logic
        function updateAirportForm() {
            const serviceType = document.getElementById("airport-service-type").value;
            const addressGroup = document.getElementById("address-group");
            addressGroup.querySelector("label").textContent = serviceType === "pickup" ? translations[currentLang].dropoff_address : translations[currentLang].pickup_address;
            updateCostEstimate();
        }

        // Travel Form Logic
        function updateTravelForm() {
            const package = document.getElementById("package").value;
            const destinations = document.getElementById("destinations");
            const adultsGroup = document.getElementById("adults-group");
            const kidsGroup = document.getElementById("kids-group");
            const travelersGroup = document.getElementById("travelers-group");
            destinations.innerHTML = "";
            const allDestinations = [
                "Disneyland", "California Adventure", "Universal Studios", "San Diego Zoo",
                "SeaWorld", "LegoLand", "Las Vegas", "Grand Canyon", "San Francisco",
                "Yosemite", "Lake Tahoe", "Reno", "Silicon Valley"
            ];
            const packageDestinations = {
                disneyland: ["Disneyland", "California Adventure"],
                sandiego: ["San Diego Zoo", "SeaWorld", "LegoLand"],
                universal: ["Universal Studios"],
                nationalparks: ["Grand Canyon", "Yosemite"],
                citygetaway: ["Las Vegas", "San Francisco", "Reno"]
            };
            let availableDestinations = package === "custom" ? allDestinations : packageDestinations[package] || allDestinations;
            availableDestinations.forEach(dest => {
                const option = document.createElement("option");
                option.value = dest;
                option.textContent = dest;
                destinations.appendChild(option);
            });
            const isThemePark = ["disneyland", "universal"].includes(package);
            adultsGroup.classList.toggle("hidden", !isThemePark);
            kidsGroup.classList.toggle("hidden", !isThemePark);
            travelersGroup.classList.toggle("hidden", isThemePark);
            document.getElementById("meals-group").classList.toggle("hidden", !["San Francisco", "Silicon Valley"].some(d => availableDestinations.includes(d)));
            updateCostEstimate();
        }

        function updateTravelers() {
            const adults = parseInt(document.getElementById("adults").value) || 0;
            const kids = parseInt(document.getElementById("kids").value) || 0;
            const total = adults + kids;
            document.getElementById("travelers-travel").value = total;
            updateCostEstimate();
        }

        function updateLodging() {
            const lodging = document.getElementById("lodging").value;
            const dropoffAddressGroup = document.getElementById("dropoff-address-group");
            dropoffAddressGroup.classList.toggle("hidden", lodging !== "none");
            updateCostEstimate();
        }

        function toggleAirportPickup() {
            const airportPickup = document.getElementById("airport-pickup").checked;
            const airportPickupGroup = document.getElementById("airport-pickup-group");
            const pickupAddressGroup = document.getElementById("pickup-address-group");
            const lodging = document.getElementById("lodging").value;
            airportPickupGroup.classList.toggle("hidden", !airportPickup);
            pickupAddressGroup.classList.toggle("hidden", lodging !== "none");
            updateCostEstimate();
        }

        // Cost Estimation
        const distances = {
            "Disneyland": 60,
            "California Adventure": 60,
            "Universal Studios": 100,
            "San Diego Zoo": 190,
            "SeaWorld": 190,
            "LegoLand": 140,
            "Las Vegas": 540,
            "Grand Canyon": 960,
            "San Francisco": 860,
            "Yosemite": 700,
            "Lake Tahoe": 960,
            "Reno": 1000,
            "Silicon Valley": 760
        };

        const admissionFees = {
            "San Diego Zoo": 70,
            "SeaWorld": 90,
            "LegoLand": 100,
            "Las Vegas": 0,
            "Grand Canyon": 25,
            "San Francisco": 0,
            "Yosemite": 20,
            "Lake Tahoe": 0,
            "Reno": 0,
            "Silicon Valley": 20,
            "Disneyland": { adult: 150, kid: 100, vip: { adult: 300, kid: 200 }, express: { adult: 200, kid: 150 } },
            "California Adventure": { adult: 150, kid: 100, vip: { adult: 300, kid: 200 }, express: { adult: 200, kid: 150 } },
            "Universal Studios": { adult: 120, kid: 80, vip: { adult: 250, kid: 180 }, express: { adult: 180, kid: 130 } }
        };

        const lodgingCosts = {
            "Disneyland": { hotel: 200, airbnb: 150 },
            "California Adventure": { hotel: 200, airbnb: 150 },
            "Universal Studios": { hotel: 180, airbnb: 130 },
            "San Diego Zoo": { hotel: 160, airbnb: 120 },
            "SeaWorld": { hotel: 160, airbnb: 120 },
            "LegoLand": { hotel: 160, airbnb: 120 },
            "Las Vegas": { hotel: 120, airbnb: 100 },
            "Grand Canyon": { hotel: 140, airbnb: 110 },
            "San Francisco": { hotel: 250, airbnb: 200 },
            "Yosemite": { hotel: 180, airbnb: 140 },
            "Lake Tahoe": { hotel: 200, airbnb: 160 },
            "Reno": { hotel: 130, airbnb: 100 },
            "Silicon Valley": { hotel: 250, airbnb: 200 }
        };

        async function calculateDistance(address) {
            if (!address) return 0;
            const response = await fetch(`https://maps.googleapis.com/maps/api/distancematrix/json?origins=Santa+Ana,CA&destinations=${encodeURIComponent(address)}&key=${googleMapsApiKey}`);
            const data = await response.json();
            if (data.rows[0].elements[0].status === "OK") {
                return data.rows[0].elements[0].distance.value / 1609.34; // Convert meters to miles
            }
            return 0;
        }

        async function updateCostEstimate() {
            const serviceType = document.getElementById("service-type").value;
            let estimate = { transport: 0, admission: 0, meals: 0, lodging: 0, total: 0 };
            let output = "";

            if (serviceType === "airport") {
                const airportServiceType = document.getElementById("airport-service-type").value;
                const airport = document.getElementById("airport").value;
                const address = document.getElementById("address").value;
                const travelers = parseInt(document.getElementById("travelers").value) || 1;
                let cost = 0;
                if (address.includes("Los Angeles") || address.match(/90[0-9]{3}/)) cost = 100;
                else if (address.includes("Long Beach") || address.match(/908[0-9]{2}/)) cost = 80;
                else if (address.match(/926[0-9]{2}|927[0-9]{2}|928[0-9]{2}/) || address.includes("Anaheim") || address.includes("Irvine") || address.includes("Huntington Beach")) cost = 50;
                else {
                    const distance = await calculateDistance(address);
                    cost = distance * 2.5 * 2; // Round-trip
                }
                if (travelers > 3) cost += 30 + cost * 0.2; // Mercedes surcharge
                estimate.transport = cost;
                estimate.total = cost;
                output = `
                    <h3>Ước Tính Chi Phí</h3>
                    <p>Vận Chuyển: $${estimate.transport.toFixed(2)}</p>
                    <p><strong>Tổng Cộng: $${estimate.total.toFixed(2)}</strong></p>
                `;
                document.getElementById("airport-cost-estimate").innerHTML = output;
            } else {
                const package = document.getElementById("package").value;
                const destinations = Array.from(document.getElementById("destinations").selectedOptions).map(opt => opt.value);
                const adults = parseInt(document.getElementById("adults").value) || 0;
                const kids = parseInt(document.getElementById("kids").value) || 0;
                const travelers = parseInt(document.getElementById("travelers-travel").value) || (adults + kids);
                const days = parseInt(document.getElementById("days").value) || 1;
                const lodging = document.getElementById("lodging").value;
                const meals = document.getElementById("meals").checked && destinations.some(d => ["San Francisco", "Silicon Valley"].includes(d));
                const airportPickup = document.getElementById("airport-pickup").checked;
                const pickupAddress = document.getElementById("pickup-address").value;

                // Transportation
                const maxDistance = Math.max(...destinations.map(d => distances[d] || 0));
                let transportCost = maxDistance * 2.5 * 2 * days; // Round-trip
                if (travelers > 3) transportCost += 30 * days + transportCost * 0.2; // Mercedes surcharge
                estimate.transport = transportCost;

                // Airport Pickup
                if (airportPickup) {
                    let pickupCost = 50; // Default for lodging
                    if (lodging === "none") {
                        if (pickupAddress.includes("Los Angeles") || pickupAddress.match(/90[0-9]{3}/)) pickupCost = 100;
                        else if (pickupAddress.includes("Long Beach") || pickupAddress.match(/908[0-9]{2}/)) pickupCost = 80;
                        else if (pickupAddress.match(/926[0-9]{2}|927[0-9]{2}|928[0-9]{2}/) || pickupAddress.includes("Anaheim") || pickupAddress.includes("Irvine") || pickupAddress.includes("Huntington Beach")) pickupCost = 50;
                        else {
                            const distance = await calculateDistance(pickupAddress);
                            pickupCost = distance * 2.5 * 2;
                        }
                    }
                    if (travelers > 3) pickupCost += 30 + pickupCost * 0.2; // Mercedes surcharge
                    estimate.transport += pickupCost;
                }

                // Admission Fees
                destinations.forEach(dest => {
                    if (["Disneyland", "California Adventure", "Universal Studios"].includes(dest)) {
                        estimate.admission += (adults * admissionFees[dest].adult + kids * admissionFees[dest].kid);
                    } else {
                        estimate.admission += travelers * (admissionFees[dest] || 0);
                    }
                });

                // Lodging
                if (lodging !== "none") {
                    const primaryDest = destinations[0] || "Disneyland";
                    let lodgingCost = lodgingCosts[primaryDest][lodging] * days;
                    if (lodging === "hotel" && travelers > 5) lodgingCost *= Math.ceil(travelers / 5); // Multiple rooms
                    if (lodging === "airbnb") lodgingCost += (travelers - 2) * 20; // Extra cost per person
                    estimate.lodging = lodgingCost;
                }

                // Meals
                if (meals) {
                    estimate.meals = travelers * 35 * days;
                }

                estimate.total = estimate.transport + estimate.admission + estimate.lodging + estimate.meals;

                output = `
                    <h3>Ước Tính Chi Phí</h3>
                    <p>Vận Chuyển: $${estimate.transport.toFixed(2)}</p>
                    <p>Vé Vào Cửa: $${estimate.admission.toFixed(2)}</p>
                    <p>Chỗ Ở: $${estimate.lodging.toFixed(2)}</p>
                    <p>Bữa Ăn: $${estimate.meals.toFixed(2)}</p>
                    <p><strong>Tổng Cộng: $${estimate.total.toFixed(2)}</strong></p>
                `;
                document.getElementById("travel-cost-estimate").innerHTML = output;

                // PayPal Button
                paypal.Buttons({
                    createOrder: (data, actions) => {
                        return actions.order.create({
                            purchase_units: [{
                                amount: {
                                    value: (estimate.lodging + estimate.admission).toFixed(2),
                                    currency_code: "USD"
                                },
                                payee: {
                                    email_address: "Johnntd21@icloud.com"
                                }
                            }]
                        });
                    },
                    onApprove: (data, actions) => {
                        return actions.order.capture().then(details => {
                            alert("Thanh toán thành công!");
                            document.getElementById("travel-form").submit();
                        });
                    }
                }).render("#paypal-button-container");
            }
        }

        // Booking Availability
        async function checkAvailability() {
            const dateInput = document.getElementById("service-type").value === "airport" ? "pickup-date" : "pickup-date-travel";
            const selectedDate = new Date(document.getElementById(dateInput).value);
            const dateStr = selectedDate.toISOString().split("T")[0];
            const bookings = await db.collection("bookings").where("date", "==", dateStr).get();
            if (!bookings.empty) {
                alert(translations[currentLang === "vi" ? "vi" : "en"].date_time + " không khả dụng. Vui lòng chọn ngày khác.");
                document.getElementById(dateInput).value = "";
            }
        }

        // Form Submission
        document.getElementById("airport-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const date = new Date(document.getElementById("pickup-date").value).toISOString().split("T")[0];
            await db.collection("bookings").add({ date, type: "airport" });
            e.target.submit(); // Redirect to thankyou.html via Formspree
        });

        document.getElementById("travel-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const date = new Date(document.getElementById("pickup-date-travel").value).toISOString().split("T")[0];
            await db.collection("bookings").add({ date, type: "travel" });
            e.target.submit(); // Redirect to thankyou.html via Formspree
        });

        // Initialize
        toggleServiceForm();
        updateTravelForm();
        updateCostEstimate();
    </script>
</body>
</html>
